if (first_met > signal_start && first_met <= signal_end){signal_first_met_affected = "Partially conserved"}
if (first_met >= (signal_end + 1)){signal_first_met_affected = "Lost"}
}
if (!is.na(first_kozak)){
if (first_kozak == signal_start){signal_first_kozak_affected = "Totally conserved"}
if (first_kozak > signal_start && first_kozak <= signal_end){signal_first_kozak_affected = "Partially conserved"}
if (first_kozak >= (signal_end + 1)){signal_first_kozak_affected = "Lost"}
}
}
csv[i, "SIGNAL_FIRST_MET_AFFECTED"] = signal_first_met_affected
csv[i, "SIGNAL_FIRST_KOZAK_AFFECTED"] = signal_first_kozak_affected
}
return(csv)
}
add_mutation_type = function(csv){
for (i in 1:nrow(csv)){
codon_change = trimws(csv[i, "CODON_CHANGE"])
if (!is.na(codon_change) && "" != codon_change){
splitted = strsplit(codon_change, "/")
original = splitted[[1]][1]
mutated = splitted[[1]][2]
if(nchar(original) > nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Deletion"
} else if(nchar(original) < nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Insertion"
} else {
csv[i, "VARIATION_TYPE"] = "Nucleotid change"
}
}
}
return(csv)
}
# Leer el csv sin filtros
csv = read.csv("final_out_no_filter.csv", sep="\t",stringsAsFactors=FALSE)
View(search(csv, exome_tables[["Exoma 10-164.xlsx"]]))
View(exome_tables[["Exoma 11-584.xlsx"]])
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
View(exome_tables[["Paqui.xlsx"]])
xls=exome_tables[["14-173.xlsx"]]
xls[!is.na(xls$dbsnp),]
xls[!is.na(xls$dbsnp),xls$dbsnp]
xls[!is.na(xls$dbsnp),2]
xls[!is.na(xls$dbsnp),"dbsnp"]
get_dbsnp_ids = function(xls){
if("dbsnp" %in% colnames(xls)){
return(sort(xls[!is.na(xls$dbsnp, "dbsnp"]))
}
}
get_dbsnp_ids = function(xls){
if("dbsnp" %in% colnames(xls)){
return(sort(xls[!is.na(xls$dbsnp, "dbsnp"])))
get_dbsnp_ids = function(xls){
if("dbsnp" %in% colnames(xls)){
return(sort(xls[!is.na(xls$dbsnp), "dbsnp"])))
}
}
return(sort(xls[!is.na(xls$dbsnp), "dbsnp"])))
get_dbsnp_ids = function(xls){
if("dbsnp" %in% colnames(xls)){
return(sort(xls[!is.na(xls$dbsnp), "dbsnp"]))
}
}
dbsnp_ids = c()
for (file in exome_files){
dbsnp_ids = c(dbsnp_ids, as.vector(get_dbsnp_ids(exome_tables[[file]])))
}
dbsnp_ids
length(dbsnp_ids)
length(unique(dbsnp_ids))
unique(dbsnp_ids)
View(exome_tables[["14-173.xlsx"]])
View(exome_tables[["2064.xlsx"]])
View(exome_tables[["ABGP.xlsx"]])
View(exome_tables[["Exoma 10-164.xlsx"]])
View(exome_tables[["Exoma 11-584.xlsx"]])
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
View(exome_tables[["Paqui.xlsx"]])
View(exome_tables[["14-173.xlsx"]])
View(exome_tables[["2064.xlsx"]])
View(exome_tables[["ABGP.xlsx"]])
View(exome_tables[["Exoma 10-164.xlsx"]])
View(exome_tables[["Exoma 11-584.xlsx"]])
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
View(exome_tables[["Paqui.xlsx"]])
table (dbsnp_ids)
View(table (dbsnp_ids))
View(exome_tables[["14-173.xlsx"]])
View(exome_tables[["2064.xlsx"]])
View(exome_tables[["ABGP.xlsx"]])
View(exome_tables[["Exoma 10-164.xlsx"]])
View(exome_tables[["Exoma 11-584.xlsx"]])
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
View(exome_tables[["Paqui.xlsx"]])
View(exome_tables[["14-173.xlsx"]])
View(exome_tables[["2064.xlsx"]])
View(exome_tables[["ABGP.xlsx"]])
View(exome_tables[["Exoma 10-164.xlsx"]])
View(exome_tables[["Exoma 11-584.xlsx"]])
View(search(csv, exome_tables[["Exoma 10-164.xlsx"]]))
View(search(csv, exome_tables[["Exoma 2166 nuevo.xlsx"]]))
View(search(csv, exome_tables[["Paqui.xlsx"]]))
View(exome_tables[["Exoma 11-584.xlsx"]])
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
View(exome_tables[["Paqui.xlsx"]])
View(search(csv, exome_tables[["14-173.xlsx"]]))
View(exome_tables[["14-173.xlsx"]])
View(search(csv, exome_tables[["2064.xlsx"]]))
View(exome_tables[["2064.xlsx"]])
View(search(csv, exome_tables[["ABGP.xlsx"]]))
View(exome_tables[["ABGP.xlsx"]])
View(search(csv, exome_tables[["Exoma 10-164.xlsx"]]))
View(exome_tables[["Exoma 10-164.xlsx"]])
View(search(csv, exome_tables[["Exoma 11-584.xlsx"]]))
View(exome_tables[["Exoma 11-584.xlsx"]])
View(search(csv, exome_tables[["Exoma 2166 nuevo.xlsx"]]))
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
View(search(csv, exome_tables[["Paqui.xlsx"]]))
View(exome_tables[["Paqui.xlsx"]])
View(exome_tables[["14-173.xlsx"]])
View(exome_tables[["2064.xlsx"]])
View(exome_tables[["ABGP.xlsx"]])
View(exome_tables[["Exoma 10-164.xlsx"]])
View(exome_tables[["Exoma 11-584.xlsx"]])
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
View(exome_tables[["Paqui.xlsx"]])
View(exome_tables[["14-173.xlsx"]])
View(exome_tables[["Exoma 2166 nuevo.xlsx"]])
setwd("/home/fabad/hemodonacion/data/tsv")
add_signal_lost_sup_info = function(csv){
for (i in 1:nrow(csv)){
signal_start = csv[i,"SIGNAL_PEPTIDE_START"]
# Sumamos dos ya que en el csv se indica el inicio del ultimo codon
# De esta forma, signal_end tiene el nucleotido exacto donde
# termina el peptido seÃ±al.
signal_end = (csv[i,"SIGNAL_PEPTIDE_END"]) + 2
first_met = csv[i,"FIRST_MET_POSITION"]
first_kozak = csv[i,"KOZAK_START"]
signal_first_met_affected = NA
signal_first_kozak_affected = NA
if (!is.na(signal_start) && !is.na(signal_end)){
if(!is.na(first_met)){
if (first_met == signal_start){signal_first_met_affected = "Totally conserved"}
if (first_met > signal_start && first_met <= signal_end){signal_first_met_affected = "Partially conserved"}
if (first_met >= (signal_end + 1)){signal_first_met_affected = "Lost"}
}
if (!is.na(first_kozak)){
if (first_kozak == signal_start){signal_first_kozak_affected = "Totally conserved"}
if (first_kozak > signal_start && first_kozak <= signal_end){signal_first_kozak_affected = "Partially conserved"}
if (first_kozak >= (signal_end + 1)){signal_first_kozak_affected = "Lost"}
}
}
csv[i, "SIGNAL_FIRST_MET_AFFECTED"] = signal_first_met_affected
csv[i, "SIGNAL_FIRST_KOZAK_AFFECTED"] = signal_first_kozak_affected
}
return(csv)
}
add_mutation_type = function(csv){
for (i in 1:nrow(csv)){
codon_change = trimws(csv[i, "CODON_CHANGE"])
if (!is.na(codon_change) && "" != codon_change){
splitted = strsplit(codon_change, "/")
original = splitted[[1]][1]
mutated = splitted[[1]][2]
if(nchar(original) > nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Deletion"
} else if(nchar(original) < nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Insertion"
} else {
csv[i, "VARIATION_TYPE"] = "Nucleotid change"
}
}
}
return(csv)
}
# Leer el csv sin filtros
csv = read.csv("final_out_no_filter.csv", sep="\t",stringsAsFactors=FALSE)
csv[,"MUTATED_SEQUENCE_LENGTH"]=as.numeric(gsub("%","",csv$MUTATED_SEQUENCE_LENGTH))
csv[,"KOZAK_MUTATED_SEQUENCE_LENGTH"]=as.numeric(gsub("%","",csv$KOZAK_MUTATED_SEQUENCE_LENGTH))
csv = add_signal_lost_sup_info(csv)
csv = add_mutation_type(csv)
csv$READING_FRAME_STATUS = factor(csv$READING_FRAME_STATUS)
csv$KOZAK_READING_FRAME_STATUS = factor(csv$KOZAK_READING_FRAME_STATUS)
csv$KOZAK_STOP_CODON = factor(csv$KOZAK_STOP_CODON)
csv$STOP_CODON_POSITION = factor(csv$STOP_CODON_POSITION)
csv$GENE_NAME = factor(csv$GENE_NAME)
csv$SIGNAL_FIRST_MET_AFFECTED = factor(csv$SIGNAL_FIRST_MET_AFFECTED)
csv$SIGNAL_FIRST_KOZAK_AFFECTED = factor(csv$SIGNAL_FIRST_KOZAK_AFFECTED)
# Eliminar los casos en los que hay errores en las regiones 5' o 3'
csv = csv[csv$CDS_ERRORS == '',]
# Eliminar los casos en los que el biotipo es "non_stop_decay" o "nonsense_mediated_decay"
csv = csv[csv$TRANSCRIPT_BIOTYPE != 'non_stop_decay' & csv$TRANSCRIPT_BIOTYPE != 'nonsense_mediated_decay',]
# Numero de genes con mutaciones afectando en el codon de inicio
length(unique(csv$GENE_NAME))
View(table(csv$GENE_NAME))
nrow(csv)/length(unique(csv$GENE_NAME))
# Transcritos afectados de TP53, CACNA1C y TP53
length(unique(csv[csv$GENE_NAME=="TP53",]$TRANSCRIPT_ID))
length(unique(csv[csv$GENE_NAME=="CACNA1C",]$TRANSCRIPT_ID))
length(unique(csv[csv$GENE_NAME=="CDKN2A",]$TRANSCRIPT_ID))
# Numero de deleciones, inserciones y cambios puntuales
View(table(csv$VARIATION_TYPE))
# El uso de la metionina en kozak fuerte provoca la conservacion del marco
# de lectura en mayor medida que la primera metionina encontrada?
rf_met_conserved = nrow(csv[csv$READING_FRAME_STATUS == "Conserved",]); rf_met_conserved
rf_met_lost = nrow(csv[csv$READING_FRAME_STATUS == "Lost",]); rf_met_lost
rf_kozak_conserved = nrow(csv[csv$KOZAK_READING_FRAME_STATUS == "Conserved",]); rf_kozak_conserved
rf_kozak_lost = nrow(csv[csv$KOZAK_READING_FRAME_STATUS == "Lost",]); rf_kozak_lost
m = as.table(rbind(c(rf_met_conserved, rf_met_lost), c(rf_kozak_conserved, rf_kozak_lost)))
dimnames(m) = list(alt_met=c("First Met", "Kozak Met"),
reading_frame=c("Conserved", "Lost"))
m
chisq.test(m) # Muy significativo. El uso de la metionina en una secuencia de kozak fuerte favorece el mantenimiento del marco de lectura.
# Obtener un conjunto en el que existe MAF definida y otro en el que no.
csvWithMaf = csv[!is.na(csv$MINOR_ALLELE_FREQUENCY),]
csvNoMaf = csv[is.na(csv$MINOR_ALLELE_FREQUENCY),]
# Dividir el subconjunto con MAF definida en MAF alta y baja
highMaf = csvWithMaf[csvWithMaf$MINOR_ALLELE_FREQUENCY >= 0.01,]
lowMaf = csvWithMaf[csvWithMaf$MINOR_ALLELE_FREQUENCY < 0.01,]
# Resumen de cada subconjunto de datos segun la maf
summary(lowMaf$FIRST_MET_POSITION)
summary(lowMaf$SIGNAL_FIRST_MET_AFFECTED)
summary(lowMaf$READING_FRAME_STATUS)
# Marco de lectura conservado si, ademas de tener "Conserved" tiene una longitud mayor al 1% de la seq original
rf_conserved_met_low_maf = nrow(lowMaf[lowMaf$MUTATED_SEQUENCE_LENGTH > 1 & lowMaf$READING_FRAME_STATUS == 'Conserved',])
rf_lost_met_low_maf = nrow(lowMaf[lowMaf$MUTATED_SEQUENCE_LENGTH <= 1 & lowMaf$READING_FRAME_STATUS == 'Conserved',]) + nrow(lowMaf[lowMaf$READING_FRAME_STATUS == 'Lost',])
summary(lowMaf$SIGNAL_FIRST_MET_AFFECTED)
summary(highMaf$FIRST_MET_POSITION)
summary(highMaf$SIGNAL_FIRST_MET_AFFECTED)
summary(highMaf$READING_FRAME_STATUS)
rf_conserved_met_high_maf = nrow(highMaf[highMaf$MUTATED_SEQUENCE_LENGTH > 1 & highMaf$READING_FRAME_STATUS == 'Conserved',])
rf_lost_met_high_maf = nrow(highMaf[highMaf$MUTATED_SEQUENCE_LENGTH <= 1 & highMaf$READING_FRAME_STATUS == 'Conserved',]) + nrow(highMaf[highMaf$READING_FRAME_STATUS == 'Lost',])
summary(highMaf$SIGNAL_FIRST_MET_AFFECTED)
summary(lowMaf$KOZAK_START)
summary(lowMaf$SIGNAL_FIRST_KOZAK_AFFECTED)
summary(lowMaf$KOZAK_READING_FRAME_STATUS)
rf_conserved_kozak_low_maf = nrow(lowMaf[lowMaf$KOZAK_MUTATED_SEQUENCE_LENGTH > 1 & lowMaf$KOZAK_READING_FRAME_STATUS == 'Conserved',])
rf_lost_kozak_low_maf = nrow(lowMaf[lowMaf$KOZAK_MUTATED_SEQUENCE_LENGTH <= 1 & !is.na(lowMaf$KOZAK_MUTATED_SEQUENCE_LENGTH) & lowMaf$KOZAK_READING_FRAME_STATUS == 'Conserved',]) + nrow(lowMaf[lowMaf$KOZAK_READING_FRAME_STATUS == 'Lost',])
summary(lowMaf$SIGNAL_FIRST_KOZAK_AFFECTED)
summary(highMaf$KOZAK_START)
summary(highMaf$SIGNAL_FIRST_KOZAK_AFFECTED)
summary(highMaf$KOZAK_READING_FRAME_STATUS)
rf_conserved_kozak_high_maf = nrow(highMaf[highMaf$KOZAK_MUTATED_SEQUENCE_LENGTH > 1 & highMaf$KOZAK_READING_FRAME_STATUS == 'Conserved',])
rf_lost_kozak_high_maf = nrow(highMaf[highMaf$KOZAK_MUTATED_SEQUENCE_LENGTH <= 1 & highMaf$KOZAK_READING_FRAME_STATUS == 'Conserved',]) + nrow(highMaf[highMaf$KOZAK_READING_FRAME_STATUS == 'Lost',])
summary(highMaf$SIGNAL_FIRST_KOZAK_AFFECTED)
# Histogramas de la posiciÃ³n de la primera metionina
hist(highMaf$FIRST_MET_POSITION, xlim = c(0,1000))
hist(lowMaf$FIRST_MET_POSITION, xlim = c(0,1000))
# Histogramas de la posiciÃ³n de la metionina de la primera secuencia Kozak
# con puntuacion mayor a 25%
hist(highMaf$KOZAK_START)
hist(lowMaf$KOZAK_START)
# Comprobar homogeneidad de varianzas
var.test(highMaf$FIRST_MET_POSITION, lowMaf$FIRST_MET_POSITION) # Varianzas distintas
var.test(highMaf$KOZAK_START, lowMaf$KOZAK_START) # Varianzas distintas
#Test de normalidad
shapiro.test(highMaf$FIRST_MET_POSITION) # No normal
shapiro.test(lowMaf$FIRST_MET_POSITION) # No normal
shapiro.test(highMaf$KOZAK_START) # No normal
shapiro.test(lowMaf$KOZAK_START) # No normal
# Test de wilcoxon para comparar medias
wilcox.test(highMaf$FIRST_MET_POSITION, lowMaf$FIRST_MET_POSITION, paired = F, conf.level = 0.95) # Distribuciones diferentes
wilcox.test(highMaf$KOZAK_START, lowMaf$KOZAK_START, paired = F, conf.level = 0.95) # Distribuciones diferentes
# Boxplots
boxplot(highMaf$FIRST_MET_POSITION, lowMaf$FIRST_MET_POSITION, ylim=c(0,3000))
boxplot(highMaf$KOZAK_START, lowMaf$KOZAK_START, ylim=c(0,1500))
op <- par(mfrow = c(1, 2))
boxplot(highMaf$FIRST_MET_POSITION, lowMaf$FIRST_MET_POSITION, ylim=c(0,250), ylab="PosiciÃ³n del codÃ³n inicial (en pares de bases)",names=c("MAF alta", "MAF baja"),
main="Comparativa de la posiciÃ³n del primer codÃ³n de inicio\nencontrado entre los grupos de MAF alta y baja.")
boxplot(highMaf$KOZAK_START, lowMaf$KOZAK_START, ylim=c(0,600), ylab="PosiciÃ³n del codÃ³n inicial (en pares de bases)", names = c("MAF alta", "MAF baja"),
main="Comparativa de la posiciÃ³n del primer codÃ³n de inicio\nencontrado en un contexto de Kozak fuerte\nentre los grupos de MAF alta y baja.")
par(op)
# Test de Chi Cuadrado para comparar las variables cualitativas
# READING FRAME STATUS
m = as.table(rbind(c(rf_conserved_met_low_maf,rf_lost_met_low_maf), c(rf_conserved_met_high_maf,rf_lost_met_high_maf)))
dimnames(m)=list(GRUPO = c("MAF BAJA", "MAF ALTA"),
READING_FRAME_STATUS = c("CONSERVED", "LOST"))
m
chisq.test(m) # p-value menor que 0.05 indica que cada grupo de mutaciones presenta diferencias significativas
###
# KOZAK READING FRAME STATUS
m = as.table(rbind(c(rf_conserved_kozak_low_maf,rf_lost_kozak_low_maf), c(rf_conserved_kozak_high_maf,rf_lost_kozak_high_maf)))
dimnames(m)=list(GRUPO = c("MAF BAJA", "MAF ALTA"),
READING_FRAME_STATUS = c("CONSERVED", "LOST"))
m
chisq.test(m) # p-value mayor que 0.05 indica que cada grupo de mutaciones no presenta diferencias significativas
# SIGNAL FIRST MET AFFECTED
high_maf_signal_values_met = table(highMaf$SIGNAL_FIRST_MET_AFFECTED)
low_maf_signal_values_met = table(lowMaf$SIGNAL_FIRST_MET_AFFECTED)
m = as.table(rbind(c(low_maf_signal_values_met), c(high_maf_signal_values_met)))
rownames(m) = c("MAF BAJA","MAF ALTA")
m
chisq.test(m) # p-value menor que 0.05 indica que cada grupo de mutaciones presenta diferencias significativas
# SIGNAL KOZAK MET AFFECTED
high_maf_signal_values_kozak = table(highMaf$SIGNAL_FIRST_KOZAK_AFFECTED)
low_maf_signal_values_kozak = table(lowMaf$SIGNAL_FIRST_KOZAK_AFFECTED)
m = as.table(rbind(c(low_maf_signal_values_kozak), c(high_maf_signal_values_kozak)))
rownames(m) = c("MAF BAJA","MAF ALTA")
m
chisq.test(m) # p-value menor que 0.05 indica que cada grupo de mutaciones presenta diferencias significativas
HOME
EnvVar(HOME)
EnvVar
setwd("~/hemodonacion/data/tsv")
add_signal_lost_sup_info = function(csv){
for (i in 1:nrow(csv)){
signal_start = csv[i,"SIGNAL_PEPTIDE_START"]
# Sumamos dos ya que en el csv se indica el inicio del ultimo codon
# De esta forma, signal_end tiene el nucleotido exacto donde
# termina el peptido seÃ±al.
signal_end = (csv[i,"SIGNAL_PEPTIDE_END"]) + 2
first_met = csv[i,"FIRST_MET_POSITION"]
first_kozak = csv[i,"KOZAK_START"]
signal_first_met_affected = NA
signal_first_kozak_affected = NA
if (!is.na(signal_start) && !is.na(signal_end)){
if(!is.na(first_met)){
if (first_met == signal_start){signal_first_met_affected = "Totally conserved"}
if (first_met > signal_start && first_met <= signal_end){signal_first_met_affected = "Partially conserved"}
if (first_met >= (signal_end + 1)){signal_first_met_affected = "Lost"}
}
if (!is.na(first_kozak)){
if (first_kozak == signal_start){signal_first_kozak_affected = "Totally conserved"}
if (first_kozak > signal_start && first_kozak <= signal_end){signal_first_kozak_affected = "Partially conserved"}
if (first_kozak >= (signal_end + 1)){signal_first_kozak_affected = "Lost"}
}
}
csv[i, "SIGNAL_FIRST_MET_AFFECTED"] = signal_first_met_affected
csv[i, "SIGNAL_FIRST_KOZAK_AFFECTED"] = signal_first_kozak_affected
}
return(csv)
}
add_mutation_type = function(csv){
for (i in 1:nrow(csv)){
codon_change = trimws(csv[i, "CODON_CHANGE"])
if (!is.na(codon_change) && "" != codon_change){
splitted = strsplit(codon_change, "/")
original = splitted[[1]][1]
mutated = splitted[[1]][2]
if(nchar(original) > nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Deletion"
} else if(nchar(original) < nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Insertion"
} else {
csv[i, "VARIATION_TYPE"] = "Nucleotid change"
}
}
}
return(csv)
}
# Leer el csv sin filtros
csv = read.csv("final_out_no_filter.csv", sep="\t",stringsAsFactors=FALSE)
library(gdata)
library(hash)
exomes_dir = "~/hemodonacion/data/exomes/"
exome_files = c("14-173.xlsx",
"2064.xlsx",
"ABGP.xlsx",
"Exoma 10-164.xlsx",
"Exoma 11-584.xlsx",
"Exoma 2166 nuevo.xlsx",
"Paqui.xlsx")
exome_tables = hash()
# Read xlsx files and store it in a hash
for (file in exome_files){
abs_file_dir = paste(exomes_dir, file, sep="")
exome_tables[file] = read.xls(abs_file_dir)
write(paste("exoma", file, "leido."), "")
}
# filter data
for (file in exome_files){
exome_tables[file] = filter_xls(exome_tables[[file]])
}
search = function(database, xls){
#found = data.frame(matrix(ncol=ncol(database)))
#colnames(found) = colnames(database)
found = read.table(text="", col.names = colnames(database))
# Si el xlsx tiene entrada para dbsnp e id de refseq
if("dbsnp" %in% colnames(xls) && "transcript" %in% colnames(xls)){
for (i in 1:nrow(xls)){
dbsnp = toString(xls[i, "dbsnp"])
refseq_id = toString(xls[i,"transcript"])
entry = database[database$TRANSCRIPT_REFSEQ_ID == refseq_id & !is.na(database$TRANSCRIPT_REFSEQ_ID) & database$VARIATION_NAME == dbsnp & !is.na(database$VARIATION_NAME), ]
if (!is.na(entry) && nrow(entry) != 0){
found = rbind(found, entry)
}
}
}
# Si tiene id de transcrito de ensembl y cambio de nucleotido del tipo aTg/aAg
else if("Feature" %in% colnames(xls) && "Codons" %in% colnames(xls)){
for (i in 1:nrow(xls)){
transcript_id = xls[i, "Feature"]
codon_change = xls[i,"Codons"]
entry = database[database$TRANSCRIPT_ID == transcript_id & !is.na(database$TRANSCRIPT_ID) & database$CODON_CHANGE == codon_change & !is.na(database$CODON_CHANGE), ]
if(!is.na(entry) && nrow(entry) != 0){
found = rbind(found, entry)
}
}
}
return(found)
}
filter_xls = function(xls){
minCoverage = 20
minQuality = 60
# Filter the position affected by the mutation
if("proteinPos" %in% colnames(xls)){
xls = xls[xls$proteinPos == 1,]
} else if ("Protein_position" %in% colnames(xls)){
xls = xls[xls$Protein_position == 1,]
} else if ("protein" %in% colnames(xls)){
index = with(xls, grepl("p.Met1[a-zA-Z]", protein))
xls = xls[index,]
}
# Filter by coverage and quality
if ("coverage" %in% colnames(xls)){
xls = xls[xls$coverage >= minCoverage,]
} else if ("QUAL" %in% colnames(xls)){
xls = xls[xls$QUAL >= minQuality,]
}
return(xls)
}
get_gene_names = function(xls){
if("gene" %in% colnames(xls)){
return(sort(xls$gene))
} else if("GeneSymbol" %in% colnames(xls)){
return(sort(xls$GeneSymbol))
} else if("Gene.Name" %in% colnames(xls)){
return(sort(xls$Gene.Name))
}
}
get_dbsnp_ids = function(xls){
if("dbsnp" %in% colnames(xls)){
return(sort(xls[!is.na(xls$dbsnp), "dbsnp"]))
}
}
for (file in exome_files){
exome_tables[file] = filter_xls(exome_tables[[file]])
}
# get genes
genes = c()
for (file in exome_files){
genes = c(genes, as.vector(get_gene_names(exome_tables[[file]])))
}
# get dbsnp ids
dbsnp_ids = c()
for (file in exome_files){
dbsnp_ids = c(dbsnp_ids, as.vector(get_dbsnp_ids(exome_tables[[file]])))
}
setwd("~/hemodonacion/data/tsv")
add_signal_lost_sup_info = function(csv){
for (i in 1:nrow(csv)){
signal_start = csv[i,"SIGNAL_PEPTIDE_START"]
# Sumamos dos ya que en el csv se indica el inicio del ultimo codon
# De esta forma, signal_end tiene el nucleotido exacto donde
# termina el peptido seÃ±al.
signal_end = (csv[i,"SIGNAL_PEPTIDE_END"]) + 2
first_met = csv[i,"FIRST_MET_POSITION"]
first_kozak = csv[i,"KOZAK_START"]
signal_first_met_affected = NA
signal_first_kozak_affected = NA
if (!is.na(signal_start) && !is.na(signal_end)){
if(!is.na(first_met)){
if (first_met == signal_start){signal_first_met_affected = "Totally conserved"}
if (first_met > signal_start && first_met <= signal_end){signal_first_met_affected = "Partially conserved"}
if (first_met >= (signal_end + 1)){signal_first_met_affected = "Lost"}
}
if (!is.na(first_kozak)){
if (first_kozak == signal_start){signal_first_kozak_affected = "Totally conserved"}
if (first_kozak > signal_start && first_kozak <= signal_end){signal_first_kozak_affected = "Partially conserved"}
if (first_kozak >= (signal_end + 1)){signal_first_kozak_affected = "Lost"}
}
}
csv[i, "SIGNAL_FIRST_MET_AFFECTED"] = signal_first_met_affected
csv[i, "SIGNAL_FIRST_KOZAK_AFFECTED"] = signal_first_kozak_affected
}
return(csv)
}
add_mutation_type = function(csv){
for (i in 1:nrow(csv)){
codon_change = trimws(csv[i, "CODON_CHANGE"])
if (!is.na(codon_change) && "" != codon_change){
splitted = strsplit(codon_change, "/")
original = splitted[[1]][1]
mutated = splitted[[1]][2]
if(nchar(original) > nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Deletion"
} else if(nchar(original) < nchar(mutated)){
csv[i, "VARIATION_TYPE"] = "Insertion"
} else {
csv[i, "VARIATION_TYPE"] = "Nucleotid change"
}
}
}
return(csv)
}
# Leer el csv sin filtros
csv = read.csv("final_out_no_filter.csv", sep="\t",stringsAsFactors=FALSE)
csv[,"MUTATED_SEQUENCE_LENGTH"]=as.numeric(gsub("%","",csv$MUTATED_SEQUENCE_LENGTH))
csv[,"KOZAK_MUTATED_SEQUENCE_LENGTH"]=as.numeric(gsub("%","",csv$KOZAK_MUTATED_SEQUENCE_LENGTH))
csv = add_signal_lost_sup_info(csv)
csv = add_mutation_type(csv)
csv$READING_FRAME_STATUS = factor(csv$READING_FRAME_STATUS)
csv$KOZAK_READING_FRAME_STATUS = factor(csv$KOZAK_READING_FRAME_STATUS)
csv$KOZAK_STOP_CODON = factor(csv$KOZAK_STOP_CODON)
csv$STOP_CODON_POSITION = factor(csv$STOP_CODON_POSITION)
csv$GENE_NAME = factor(csv$GENE_NAME)
csv$SIGNAL_FIRST_MET_AFFECTED = factor(csv$SIGNAL_FIRST_MET_AFFECTED)
csv$SIGNAL_FIRST_KOZAK_AFFECTED = factor(csv$SIGNAL_FIRST_KOZAK_AFFECTED)
# Eliminar los casos en los que hay errores en las regiones 5' o 3'
csv = csv[csv$CDS_ERRORS == '',]
# Eliminar los casos en los que el biotipo es "non_stop_decay" o "nonsense_mediated_decay"
csv = csv[csv$TRANSCRIPT_BIOTYPE != 'non_stop_decay' & csv$TRANSCRIPT_BIOTYPE != 'nonsense_mediated_decay',]
write.table(csv, file = "final_out_filter.csv", na="", sep="\t", row.names = F)
