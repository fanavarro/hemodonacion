library(seqLogo)
library(PWMEnrich)
setwd("/home/fabad/hemodonacion/src")

# Leer las secuencias alrededor del codon de inicio extraidas de ensembl
kozakContextSequences = readDNAStringSet("kozaks2.fasta", format = "fasta")

# Crear la matrix de counts a partir de las secuencias
pfm = consensusMatrix(kozakContextSequences, as.prob = F)

# Crear la matriz de peso
pwm = data.matrix(read.table("myUtils/pwm/kozak_context.pwm"))

# Secuencia de prueba sobre la que buscar matches
ins = "TCTGCCCCACCCTGTCCTCTGGAACCTCTGCGAGATTTAGAGGAAAGAACCAGTTTTCAGGCGGATTGCCTCAGATCACACTATCTCCACTTGCCCAGCCCTGTGGAAGATTAGCGGCCATGTATTCCAATGTGATAGGAACTGTAACCTCTGGAAAAAGGAAGGTTTATCTTTTGTCCTTGCTGCTCATTGGCTTCTGGGACTGCGTGACCTGTCACGGGAGCCCTGTGGACATCTGCACAGCCAAGCCGCGGGACATTCCCATGAATCCCATGTGCATTTACCGCTCCCCGGAGAAGAAGGCAACTGAGGATGAGGGCTCAGAACAGAAGATCCCGGAGGCCACCAACCGGCGTGTCTGGGAACTGTCCAAGGCCAATTCCCGCTTTGCTACCACTTTCTATCAGCACCTGGCAGATTCCAAGAATGACAATGATAACATTTTCCTGTCACCCCTGAGTATCTCCACGGCTTTTGCTATGACCAAGCTGGGTGCCTGTAATGACACCCTCCAGCAACTGATGGAGGTATTTAAGTTTGACACCATATCTGAGAAAACATCTGATCAGATCCACTTCTTCTTTGCCAAACTGAACTGCCGACTCTATCGAAAAGCCAACAAATCCTCCAAGTTAGTATCAGCCAATCGCCTTTTTGGAGACAAATCCCTTACCTTCAATGAGACCTACCAGGACATCAGTGAGTTGGTATATGGAGCCAAGCTCCAGCCCCTGGACTTCAAGGAAAATGCAGAGCAATCCAGAGCGGCCATCAACAAATGGGTGTCCAATAAGACCGAAGGCCGAATCACCGATGTCATTCCCTCGGAAGCCATCAATGAGCTCACTGTTCTGGTGCTGGTTAACACCATTTACTTCAAGGGCCTGTGGAAGTCAAAGTTCAGCCCTGAGAACACAAGGAAGGAACTGTTCTACAAGGCTGATGGAGAGTCGTGTTCAGCATCTATGATGTACCAGGAAGGCAAGTTCCGTTATCGGCGCGTGGCTGAAGGCACCCAGGTGCTTGAGTTGCCCTTCAAAGGTGATGACATCACCATGGTCCTCATCTTGCCCAAGCCTGAGAAGAGCCTGGCCAAGGTAGAGAAGGAACTCACCCCAGAGGTGCTGCAAGAGTGGCTGGATGAATTGGAGGAGATGATGCTGGTGGTCCACATGCCCCGCTTCCGCATTGAGGACGGCTTCAGTTTGAAGGAGCAGCTGCAAGACATGGGCCTTGTCGATCTGTTCAGCCCTGAAAAGTCCAAACTCCCAGGTATTGTTGCAGAAGGCCGAGATGACCTCTATGTCTCAGATGCATTCCATAAGGCATTTCTTGAGGTAAATGAAGAAGGCAGTGAAGCAGCTGCAAGTACCGCTGTTGTGATTGCTGGCCGTTCGCTAAACCCCAACAGGGTGACTTTCAAGGCCAACAGGCCTTTCCTGGTTTTTATAAGAGAAGTTCCTCTGAACACTATTATCTTCATGGGCAGAGTAGCCAACCCTTGTGTTAAGTAAAATGTTCTTATTCTTTGCACCTCTTCCTATTTTTGGTTTGTGAACAGAAGTAAAAATAAATACAAACTACTTCCATCTCA"
ins = "CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC"
ins="GGCATGGCGGCCAGGCAGATCTGGGCACGGACGGGTGCCGCGCTCTGCAGGCAACCTTCCGCCGCCCCGCCGCCAGCACCTCTCTGGGTAAGAGCTGGGTTCCGACAGCAGCTCAGCTTAACCCTCTGCCCTGCTAACGAGGGAAACTGCGGCGGCTCCGCGCCCAGCACGCCCGGTAGGCCGGAGAGAGCGGCGAGGCCTTCGGTGAGCGAAGAGTTAACCGCGGCGGAGCGACAGATCGCGGAGCTGCACGCTGCCGCCTGCGCGGCTGGCCAGCTAAACTATGTGGATCCAGCTACTGGCTATGTGGTGCTCACACAGATTGCCCACTTGCAAAGAGGTGAATGTTGTGGCTCTGCGTGCAGACATTGTCCATATGGTCAAGTCAATGTTAAAGATCCATCTAAAAAGAAGCAATTCAATTCATATTTTTATGTTTGACAAGAATTTCATCTCTGTTCCCTAACTGTGCTTGTATTTTTTAAAAAATAAAGCCCCAATTCAGAATTGCTGGATTATTAGTACTTGAACACTAGTTTAATCCTAAATACATATATTAAAAGAACATCAATAAAATGAAAAAGCTAA"
hits = matchPWM(pwm, ins, with.score = T)
mcols(hits)$score
a=c(21, 22)
length(start(hits))
a=(start(hits))
rbind(data.frame(start=start(hits), end=end(hits), width=width(hits), score=mcols(hits), atg = start(hits) + ((width(hits)-3)/2)))
# seqlogo necesita una matriz de frecuencias.
seqLogo(pfm[1:4 , ])
score(hits)
